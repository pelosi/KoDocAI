# KoDocAI

Upstage Document Parse API 기반의 AI 문서 파싱 클라이언트입니다. 클라우드 AI를 활용하여 PDF, 이미지, 오피스 문서에서 텍스트, 테이블, 구조 정보를 HTML/Markdown/JSON 형식으로 추출합니다.

## 프로젝트 배경

복잡한 레이아웃의 문서(병합 셀 테이블, 스캔 이미지 등)는 규칙 기반 파서로는 정확한 추출이 어렵습니다. 이 프로젝트는 AI 기반 문서 파싱의 활용 가능성을 검증하기 위해 개발되었습니다:

- **AI 기반 테이블 인식** - N x M 정형 테이블을 정확하게 HTML/Markdown으로 변환
- **OCR 지원** - 한글, 한자, 영숫자 인식으로 스캔 문서 처리
- **다중 출력 형식** - HTML, Markdown, 순수 텍스트 동시 제공
- **대용량 문서 처리** - 비동기 배치 처리로 300페이지 이상 문서 지원

## 주요 기능

- **동기 처리** - 100페이지 이하 문서의 빠른 단일 API 호출 처리
- **비동기 처리** - 100페이지 초과 문서의 배치 업로드, 폴링, 부분 다운로드 및 병합
- **HTML 비교 시각화** - 원본 PDF와 파싱 결과를 좌우 분할 화면으로 비교
- **메타데이터 보존** - 파일명, 수정 시간 등 파일 정보 함께 저장
- **성능 로깅** - 각 처리 단계별 소요 시간 측정

## 프로젝트 구조

```
KoDocAI/
├── src/                            # Python 소스 코드
│   ├── main.py                     # CLI 엔트리포인트 및 오케스트레이터
│   ├── document_parse.py           # 동기 API 래퍼 (≤100페이지)
│   ├── document_parse_async.py     # 비동기 API 래퍼 (>100페이지)
│   └── libs/
│       ├── json_saver.py           # JSON 출력 저장
│       └── logger.py               # 성능 측정 로거
├── dataset/                        # 입력 문서 저장소
├── output/                         # 추출 결과 (JSON, HTML)
├── .gitignore
└── README.md
```

## 기술 스택

- **Python 3.x** - 메인 개발 언어
- **Upstage Document Parse API v1** - AI 기반 문서 파싱 클라우드 서비스
- **requests** - HTTP 클라이언트
- **PDF.js** - HTML 비교 뷰에서 원본 PDF 렌더링 (CDN)

## 지원 파일 형식

| 형식 | 확장자 |
|------|--------|
| 문서 | PDF, DOCX, PPTX, XLSX |
| 이미지 | JPEG, PNG, BMP, TIFF, HEIC |

- 최대 파일 크기: 50MB
- 동기 처리: 최대 100페이지
- 비동기 처리: 100페이지 초과 (배치 단위 10페이지)

## 사용법

### 환경 변수 설정

```bash
# Upstage API 키 설정 필요
export UPSTAGE_API_KEY="your-api-key"
```

### 실행

```bash
python src/main.py
```

### 대화형 인터페이스

```
PDF 또는 이미지 파일명을 입력하세요. (여러 파일은 쉼표로 구분하세요)
Enter을 입력하면 프로그램이 종료됩니다.
파일명(쉼표 구분): sample_document.pdf
```

## 처리 방식 비교

| | 동기 처리 | 비동기 처리 |
|---|---|---|
| **페이지 수** | ≤100페이지 | >100페이지 |
| **API 호출** | 단일 POST | 업로드 → 폴링 → 다운로드 |
| **처리 속도** | 1페이지: ~6초, 31페이지: ~30초 | 308페이지: ~330초 |
| **결과 수신** | 즉시 반환 | 10페이지 단위 배치 다운로드 후 병합 |

## 데이터 파이프라인

```
[문서 파일] → [파일 메타데이터 추출] → [Upstage API 업로드] → [결과 수신/병합] → [JSON/HTML 저장]
                                              ↓
                                    동기(≤100p) / 비동기(>100p)
```

## 출력 구조

```
output/
├── {파일명}.json                # 파싱 결과 (HTML, Markdown, 텍스트, 요소 정보)
└── {파일명}.html                # 원본 PDF vs 파싱 결과 비교 시각화
```

### JSON 출력 예시

```json
{
  "file_metadata": {
    "file_name": "sample_document.pdf",
    "file_time": "2024-10-15 11:45:08"
  },
  "parsed_content": {
    "api": "2.0",
    "model": "document-parse-240910",
    "content": {
      "html": "<table>...</table><p>...",
      "markdown": "# ...",
      "text": "..."
    },
    "elements": [],
    "usage": {
      "pages": 308
    }
  }
}
```

## 테스트 결과 요약

### 변환 품질

| 항목 | 평가 |
|------|------|
| 정형 테이블 (N x M) | 정확하게 변환 |
| 페이지 타이틀/Heading | 정확하게 구분 |
| 문단 구분 및 특수문자 처리 | 우수 |
| 메타데이터 (페이지 번호 등) | 정확히 추출 |
| 병합 셀 테이블 | 위치 식별 부정확 |
| 표 안의 표 (중첩 테이블) | 인식 불가 |
| 이미지/그래픽 추출 | 미흡 |

### 테스트 샘플

| 문서 | 페이지 수 | 처리 방식 | 소요 시간 | 결과 |
|------|-----------|-----------|-----------|------|
| OO 신청서.png | 1 | 동기 | ~6초 | 복잡한 병합 셀로 인식 부정확 |
| OO 신청서.pdf | 1 | 동기 | ~6초 | 복잡한 병합 셀로 인식 부정확 |
| 장애유형별 구비서류 안내문.pdf | 31 | 동기 | ~30초 | 정확 |
| 차상위계층 지원사업 안내.pdf | 42 | 동기 | ~40초 | 정확 |
| 기초연금 사업 안내.pdf | 308 | 비동기 | ~330초 | 정확 |

## 관련 프로젝트

이 프로젝트는 AI/LLM 데이터 파이프라인의 일부로, 다음 프로젝트들과 함께 활용됩니다:

| 프로젝트 | 역할 | 설명 |
|----------|------|------|
| **KoFinCorpus** | 데이터 수집 | 금융 도메인 PDF/문서 코퍼스 수집기 |
| **KoDocParser** | 로컬 파싱 | PyMuPDF 기반 PDF 구조화 추출 |
| **KoDocAI** | AI 파싱 | Upstage Document Parse API 기반 AI 문서 파싱 (본 프로젝트) |

## 의존성

| 패키지 | 용도 |
|--------|------|
| requests | Upstage API HTTP 통신 |

## 라이선스

Private
